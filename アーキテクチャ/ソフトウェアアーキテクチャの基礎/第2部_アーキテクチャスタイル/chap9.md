## 基礎

### 基礎的なパターン

- **認識できるアーキテクチャ構造が不在の状態を「巨大な泥団子(Big Ball of Mud)」と呼び、アンチパターンである**。行き当たりばったりな対応で出来上がったシステムであり、無秩序で都合の良い修復が繰り返された結果である。
- ソフトウェアが誕生した当時はハードウェアとソフトウェアが一対のもの(ユニタリーアーキテクチャ)として始まり、両者の進化に伴いハードウェアとソフトウェアは分裂していった。現在のソフトウェアシステムは時間の経過に伴い、機能が肥大化する傾向にあり、パフォーマンスやスケールといったアーキテクチャの運用特性を維持するには関心ごとをハードウェアと分離する必要がある。
- **クライアント/サーバ(2層アーキテクチャ)**: フロントエンドとバックエンドに分離したスタイル。
- **デスクトップ＋データベースサーバ(2層アーキテクチャ)**: PC黎明期のアーキテクチャ。スタンドアローン型のDBサーバとプレゼンテーションロジックのデスクトップを配置した構成。
- **ブラウザ＋Webサーバ(2層アーキテクチャ)**: WebブラウザとWebサーバの二層アーキテクチャ。Webブラウザをより薄いクライアントとして利用し、Webサーバがより計算を要するような処理を行う。
- **3層**: UI層、アプリ層、インフラ(DB)層の3層で構成されたアーキテクチャ。Javaや.NETの界隈でアプリケーションサーバのツールが普及したことがきっかけ。

### モノリシックアーキテクチャと分散アーキテクチャ

- アーキテクチャスタイルは「**モノリシック**」と「**分散型**」の2種類に分類できる。
  - **モノリシック**
    - レイヤードアーキテクチャ
    - パイプラインアーキテクチャ
    - マイクロカーネルアーキテクチャ
  - **分散型**
    - サービスベースアーキテクチャ
    - イベント駆動アーキテクチャ
    - サービス思考アーキテクチャ
    - マイクロサービスアーキテクチャ
- <font color=red>分散アーキテクチャは<b>パフォーマンス、スケーラビリティ、可用性</b>の点でモノリシックアーキテクチャよりも遥かに強力</font>だが、**分散アーキテクチャは以下の8つの誤信(課題)を抱えている**。
  - **【誤信1】ネットワークは信頼できる**: <font color=red><u>分散アーキテクチャは全てのサービス間通信がネットワークに依存する</u></font>が、ネットワークは依然として信頼性は高くない。リクエストを送れない場合やレスポンスが返せない場合、タイムアウトのような機能が必要になる。
  - **【誤信2】レイテンシー(データの送信遅延や待ち時間)がゼロ**: <u>ローカル呼び出しよりもリモート呼び出し(REST、メッセージング、RPCなど)の方が時間がかかる</u>。分散アーキテクチャではネットワークを介した処理がほとんどであるため、アーキテクトは<font color=red><b>平均レイテンシーは把握するべき</b></font>である。
  - **【誤信3】帯域幅は無限**: モノリシックではほとんど考慮不要だが、サービス間通信で帯域幅を消費する。<u>ネットワーク速度低下につながるため、レイテンシーや信頼性と合わせて帯域幅を把握しておく必要がある</u>。
  - **【誤信4】ネットワークは安全**: <u>VPNや信頼できるネットワークがあるが、本来ネットワークは安全ではない</u>。 <font color=red>モノリシック→分散型に移行するとセキュリティの脅威や攻撃の表面積は飛躍的に増加する。</font>
  - **【誤信5】トポロジーは決して変化しない**: ネットワークのトポロジ(接続形態)はサービス導入や外部アプリのバージョンアップ等で日々変化の可能性を孕んでいる。<u>アーキテクトは運用担当者やネットワーク管理者と常に会話し、「何が」「いつ」変更される/されたのか把握し、それに応じて調整しなければならない</u>。
  - **【誤信6】管理者は一人だけ**: 管理者は一人ではない。レイテンシーや帯域幅、トポロジーなどの項目が複数あるようにネットワーク管理者も1人ではなく数十人の可能性がある。そのため、<u>アーキテクトは特定の管理者だけと会話をとれば良いというわけではない</u>。
  - **【誤信7】転送コストはゼロ**: <u>分散アーキテクチャのコストはモノリシックアーキテクチャよりもかなり高くなる</u>。分散アーキテクチャに着手する際は容量、帯域幅、レイテンシー、セキュリティゾーンに関して、現在のサーバ(プロキシも含む)とネットワーク(ファイアウォールやゲートウェイ、サブネットも含む)のトポロジーを分析することが重要。
  - **【誤信8】ネットワークは均一**: ネットワークは複数のハードウェアベンダで構成されており不均一であることから、信頼性、レイテンシー、帯域幅など上記全ての誤信と結びついており、影響を与える。

#### 分散コンピューティングにおけるその他の考慮事項

- **分散ロギング**: 複数のサービス間通信によりエラー発生時の原因分析が非常に困難である。
- **分散トランザクション**: 高いスケーラビリティ、パフォーマンス、可用性を実現するために<u>結果整合性を保証する必要があり、データ整合性や完全性を犠牲にしている</u>。
- **コントラクトのメンテナンスとバージョン管理**: コントラクトやバージョン管理は非常に難しい。<u>後方互換性がない場合、サービス間通信を調整する必要があり、特定サービスを廃止するなどの対応がある</u>。